var MessageBus;!function(n){function t(n){return new e(n)}var e=function(){function n(n){var t=this;this.endpoint=n,this.channels={},this.unlisten=null;var e=function(n){return t.onEvent(n.data.name,n.data.payload)},s=function(n){return t.onEvent("error",n)};n.addEventListener("message",e),n.addEventListener("error",s),this.unlisten=function(){n.removeEventListener("message",e),n.removeEventListener("error",s)}}return n.prototype.close=function(){null!==this.unlisten&&this.unlisten(),this.unlisten=null,this.channels={}},n.prototype.on=function(n,t){this.channelExists(n)||(this.channels[n]=[]),this.channels[n].push(t)},n.prototype.off=function(n,t){if(this.channelExists(n)){var e=this.channels[n],s=e.indexOf(t);-1!==s&&e.splice(s,1)}},n.prototype.emit=function(n,t){this.endpoint.postMessage({name:n,payload:t})},n.prototype.channelExists=function(n){return this.channels.hasOwnProperty(n)},n.prototype.onEvent=function(n,t){this.channelExists(n)&&this.channels[n].forEach(function(n){n(t)})},n}();n.MessageBus=e,n.create=t}(MessageBus||(MessageBus={}));